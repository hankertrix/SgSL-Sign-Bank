---
import { makeUrlFriendlyString } from "@lib/utils";

// The type of the pages
type Pages = {
	[title: string]: string | null | Pages;
};

// The type of the props for the component
type Props = {
	pages: Pages | string,
	urlStart?: string
	depth?: number;
}

// Get the props
const { pages, urlStart = "/" }: Props = Astro.props;
---

{
	Object.entries(pages).map(([title, child]) => {

		// Create the slug
		const slug = makeUrlFriendlyString(title);

		// Get the current url
		const currentUrl = `${urlStart}${slug}`;

		// Get the url title
		const urlTitle = `Go to the page called '${title}'`;

		// If the title has children
		if (child != null && Object.keys(child).length > 0) {
			return (
				<li>
					<details>

						<!-- The summary element to -->
						<!-- open and close the collapsible menu -->
						<summary>
							<div
								class="menu-toggler"
								title={
									`Show or hide the pages under '${title}'`
								}
							>
								<div class="icon" />
							</div>
							<a
								href={currentUrl}
								title={urlTitle}
								aria-label={urlTitle}
							>
								{title}
							</a>
						</summary>

						<!-- The collapsible menu to open and close -->
						<ul>
							<Astro.self
								pages={child}
								urlStart={`${currentUrl}/`}
							/>
						</ul>
					</details>
				</li>
			);
		}

		// Return the HTML
		return (
			<li class="no-child">
				<a
					href={currentUrl}
					title={urlTitle}
					aria-label={urlTitle}
				>
					{title}
				</a>
			</li>
		)
	})
}

<style>
	a {
		text-decoration: none;
		color: var(--text-colour);
	}

	a:hover {
		color: var(--link-hover-colour);
	}

	a:active {
		color: var(--link-active-colour);
	}

	summary {
		display: flex;
		flex-direction: row;
		align-items: center;
		cursor: pointer;
	}

	.menu-toggler {
		display: flex;
		cursor: pointer;
		flex-direction: row;
		align-items: center;
		justify-self: start;
	}

	.icon {
		--triangle-size: 0.25em;

		width: 0;
		height: 0;
		border-top: var(--triangle-size) solid transparent;
		border-bottom: var(--triangle-size) solid transparent;
		border-left: var(--triangle-size) solid var(--text-colour);
		margin-top: var(--triangle-size);
		margin-left: var(--triangle-size);
		margin-right: calc(var(--triangle-size) + 0.1em);
		transition:
			rotate var(--animation-timing),
			translate var(--animation-timing);
	}

	summary:hover .icon {
		border-left-color: var(--link-hover-colour);
	}

	summary:hover:has(a:hover) .icon {
		border-left-color: var(--text-colour);
	}

	.no-child > a {
		padding-left: var(--no-child-left-padding);
	}

	ul {
		margin: 0;
		margin-left: var(--list-margin-left);
		padding: 0;
		list-style-type: var(--sidebar-list-style-type);
	}

	li > a {
		display: block;
		width: 100%;
	}

	/* The styles when the collapsible is open */
	details[open] > summary > .menu-toggler > .icon {
		rotate: 90deg;
	}
</style>
