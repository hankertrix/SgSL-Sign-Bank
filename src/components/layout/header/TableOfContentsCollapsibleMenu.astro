---
import type { Heading } from "@lib/types";

// Get the heading from the props
const { heading } = Astro.props;
---

{
	(() => {

		// Get the url for the heading
		const url = `#${heading.slug}`;

		// Get the heading title
		const headingTitle = `Go to the section called '${heading.text}'`;

		// If the heading has subheadings
		if (heading.subheadings.length > 0) {
			return (
				<li>
					<details>

						<!-- The summary element to -->
						<!-- open and close the collapsible menu -->
						<summary>
							<div
								class="menu-toggler"
								title={
									"Show or hide the sections under "
									+ `'${heading.text}'`
								}
							>
								<div class="icon" />
							</div>
							<a
								href={url}
								title={headingTitle}
								aria-label={headingTitle}
							>
								{heading.text}
							</a>
						</summary>

						<!-- The collapsible menu to open and close -->
						<ul>
							{heading.subheadings.map((subheading: Heading) => (
								<Astro.self
									heading={subheading}
								/>
							))}
						</ul>
					</details>
				</li>
			)
		}

		// Return the HTML for the heading
		return (
			<li class="no-child">
				<a
					href={url}
					title={headingTitle}
					aria-label={headingTitle}
				>
					{heading.text}
				</a>
			</li>
		)
	})()
}

<style>
	a {
		text-decoration: none;
		color: var(--text-colour);
	}

	summary {
		display: flex;
		flex-direction: row;
		align-items: center;
		cursor: pointer;
	}

	.menu-toggler {
		display: flex;
		cursor: pointer;
		flex-direction: row;
		align-items: center;
		justify-self: start;
	}

	.icon {
		--triangle-size: 0.25em;

		width: 0;
		height: 0;
		border-top: var(--triangle-size) solid transparent;
		border-bottom: var(--triangle-size) solid transparent;
		border-left: var(--triangle-size) solid var(--text-colour);
		margin-top: var(--triangle-size);
		margin-left: var(--triangle-size);
		margin-right: calc(var(--triangle-size) + 0.1em);
		transition:
			rotate var(--animation-timing),
			translate var(--animation-timing);
	}

	summary:hover .icon {
		border-left-color: var(--link-hover-colour);
	}

	summary:hover:has(a:hover) .icon {
		border-left-color: var(--text-colour);
	}

	.no-child > a {
		padding-left: var(--no-child-left-padding);
	}

	ul {
		margin: 0;
		margin-left: var(--list-margin-left);
		padding: 0;
		list-style-type: var(--sidebar-list-style-type);
	}

	li > a {
		display: block;
		width: 100%;
	}

	/* The styles when the collapsible is open */
	details[open] > summary > .menu-toggler > .icon {
		rotate: 90deg;
	}
</style>
